language: nix

script: nix-build --add-drv-link --attr proto3-suite-linux --arg enableDhall true release.nix && nix-build --out-link shell.result shell.nix

## Caching: https://github.com/travis-ci/travis-ci/issues/6604
## But we deviate from that advice by caching "/nix" directly.
## We collect garbage to avoid the cache growing indefinitely.

sudo: required

before_cache: |
  nix-collect-garbage --delete-older-than 7d

cache:
  directories:
    - /nix
